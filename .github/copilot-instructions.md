# Copilot Instructions for Xentro App

- Stack: Next.js App Router (TS); fonts + globals set in [app/layout.tsx](app/layout.tsx), home hero/options live in [app/page.tsx](app/page.tsx).
- Routing shells: Public routes under [app/(public)](app/(public)) wrapped by [app/(public)/layout.tsx](app/(public)/layout.tsx); admin routes under [app/(admin)](app/(admin)) wrap pages with AuthProvider in [app/(admin)/layout.tsx](app/(admin)/layout.tsx) and guarded dashboard chrome in [app/(admin)/dashboard/layout.tsx](app/(admin)/dashboard/layout.tsx).
- Admin auth (UI only): [contexts/AuthContext.tsx](contexts/AuthContext.tsx) holds mock admin (`admin@xentro.io` / `admin123`) with 6h localStorage session; `useAuth` gates dashboard and redirects to [app/(admin)/login/page.tsx](app/(admin)/login/page.tsx) on missing session.
- Styling/UI kit: Tailwind with CSS vars (var(--primary), --radius-md, etc.); prefer components from [components/ui/index.ts](components/ui/index.ts) plus `cn` in [lib/utils.ts](lib/utils.ts); animations via classes like animate-fadeInUp and stagger-*.
- Data access: Public listing [app/(public)/institutions/page.tsx](app/(public)/institutions/page.tsx) and admin dashboards fetch `/api/institutions`; `scope=all` bypasses published-only filter in [app/api/institutions/route.ts](app/api/institutions/route.ts).
- Institution detail: [app/(public)/institutions/[id]/page.tsx](app/(public)/institutions/[id]/page.tsx) calls `institutionController.getById` server-side (dynamic render) to hydrate institution + programs/events; uses label maps from [lib/types.ts](lib/types.ts) and formatters in [lib/utils.ts](lib/utils.ts).
- Dashboard metrics: [app/(admin)/dashboard/page.tsx](app/(admin)/dashboard/page.tsx) recomputes totals, monthly counts (createdAt), and type distribution client-side from fetched institutions.
- Institution onboarding (public): 15-step wizard in [app/(public)/institution-onboarding/page.tsx](app/(public)/institution-onboarding/page.tsx) sends magic link via POST /api/institution-applications, verifies via returned link, then PUTs details; step gating handled by `canProceed`.
- API/controller pattern: API routes call controllers in [server/controllers](server/controllers) that wrap Drizzle repositories and normalize media URLs via [server/services/storage.ts](server/services/storage.ts); use `HttpError` for status-aware failures.
- Database: Drizzle schemas in [db/schemas/index.ts](db/schemas/index.ts), Neon client in [db/client.ts](db/client.ts); institutions/programs/events back public and admin views, auth tables back JWT flows.
- Institution applications: [server/controllers/institutionApplication.controller.ts](server/controllers/institutionApplication.controller.ts) issues verification tokens + emails, marks verified, and on approval creates draft institutions if missing; PATCH requires verified before approve.
- Auth for protected APIs: [server/services/auth.ts](server/services/auth.ts) signs/verifies JWT with `JWT_SECRET`; `requireAuth` (optional roles) guards routes like [app/api/approvals/mentors/route.ts](app/api/approvals/mentors/route.ts) and [app/api/approvers/route.ts](app/api/approvers/route.ts); dev helper [app/api/dev/mock-admin/route.ts](app/api/dev/mock-admin/route.ts) returns an admin JWT outside production.
- Storage/email: [server/services/storage.ts](server/services/storage.ts) targets Cloudflare R2 (R2_ACCOUNT_ID/R2_ACCESS_KEY/R2_SECRET_ACCESS_KEY/R2_BUCKET_NAME, optional R2_PUBLIC_URL) and resolves relative media keys; [server/services/email.ts](server/services/email.ts) uses SMTP vars (SMTP_HOST/PORT/USER/PASS/FROM) and logs to console when unset.
- Middleware: [middleware.ts](middleware.ts) adds x-response-time header and logs each request.
- UI data helpers: Type/SDG/sector label maps plus countries/currencies live in [lib/types.ts](lib/types.ts); formatNumber/formatCurrency/getInitials/slugify in [lib/utils.ts](lib/utils.ts).
- Assets: Logos live in /public/logos and may be resolved via `resolveMediaUrl`; keep filenames stable when referencing in data.
- Commands: npm run dev/build/start/lint; no tests configured yet.

Tell me which sections need clarification or more workflows captured.
